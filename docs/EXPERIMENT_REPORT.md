# 實驗報告

> **專案**: AGCH-Improvement  
> **建立日期**: 2026-02-04  
> **用途**: 記錄所有模型訓練與驗證實驗的結果分析

---

<!-- 新的實驗記錄請加在此處，使用 --- 分隔 -->

### 實驗記錄 ID: 20260205-5FOLD-SIGLIP2

**日期**: 2026-02-05  
**類別**: 5-Fold 交叉驗證 (Cross-Validation)  
**變更摘要**: 完成 SigLIP2 + AGCH 改進版的 5-fold 穩定性與效能驗證。

#### 1. 實驗配置
- **模型**: SigLIP2 (frozen towers) + AGCH
- **Fold 數量**: 5
- **訓練輪數**: 20 Epochs per fold
- **硬體**: RTX 5080 (16GB)

#### 2. 實驗結果 (5-Fold CV Summary)

| 指標 | Mean | Std (±) | 評語 |
|:---:|:---:|:---:|:---|
| **mAP** | **0.6787** | **0.0129** | 表現穩定，屬中上水準 |
| **AUC-Macro** | **0.9613** | **0.0009** | 極高，模型排序能力強 |
| **F1-Macro** | **0.5522** | **0.0220** | 召回率仍有提升空間 |

**各 Fold 詳細表現 (Epoch 18-19)**:

| Fold | mAP | AUC | F1-Macro |
|:---:|:---:|:---:|:---:|
| 0 | 0.6644 | 0.9606 | 0.5310 |
| 1 | 0.6982 | 0.9629 | 0.5867 |
| 2 | 0.6805 | 0.9612 | 0.5601 |
| 3 | 0.6701 | 0.9610 | 0.5389 |
| 4 | 0.6805 | 0.9609 | 0.5442 |

#### 3. Test Set 最終評估 (Fold 1)

使用驗證集表現最佳的 **Fold 1** 模型在獨立測試集 (5,000 images) 上進行評估：

| 指標 | 數值 | 與 Val 差異 | 評語 |
|:---:|:---:|:---:|:---|
| **mAP** | **0.6960** | -0.0022 | **泛化能力極佳**，幾乎無效能下降 |
| **AUC-Macro** | **0.9634** | +0.0005 | 排序能力甚至略優於驗證集 |
| **F1-Macro** | **0.5803** | -0.0064 | 保持一致 |
| **Precision** | **0.7888** | | 準確率高，誤判率低 |
| **Recall** | **0.5040** | | 召回率仍是主要改進點 |

> **結論**: Test Set 結果 (0.6960) 高度吻合 Validation 結果 (0.6982)，證實模型具有強大的泛化能力，未發生過擬合。

#### 4. 結論與分析
- **穩定性極佳**: AUC 的標準差僅 0.0009，顯示模型在不同資料切分下的排序能力極為一致。
- **Fold 1 表現突出**: mAP 接近 0.70，F1 也最高 (0.58)，值得深入分析其資料分布。
- **改進空間**: F1-Macro 相對較低 (0.55)，顯示可能在某些類別上的 threshold 需要調整，或需要 Per-class 分析來找出弱點。

---


### 實驗記錄 ID: 20260204-ENV-UPGRADE

**日期**: 2026-02-04  
**類別**: 基礎建設與環境設定  
**變更摘要**: 升級開發環境以支援 RTX 5080 (Blackwell)。

#### 1. 變更詳情

- **CUDA 升級**: 從 CUDA 12.4 升級至 CUDA 12.8 Nightly。
- **依賴項更新**: 更新 `torch`、`torchvision` 等核心庫至支援 CUDA 12.8 的 nightly 版本。
- **專案配置**: 修改 `pyproject.toml` 與 `requirements.txt` 以使用最新的 PyTorch nightly index。
- **Git 配置**: 將 `outputs/` 加入 `.gitignore`。

#### 2. 驗證結果

- **硬體相容性**: RTX 5080 運作正常，支援 sm_120 架構。
- **安裝測試**: `uv pip install` 流程順暢。

### 實驗記錄 ID: 20260204-STABILIZE

**日期**: 2026-02-04  
**類別**: 環境穩定性與模型重構  
**變更摘要**: 修正 SigLIP2 載入邏輯與損失函數路徑。

#### 1. 變更詳情

- **SigLIP2 載入**: 採用 `AutoModel` + `AutoImageProcessor` + `GemmaTokenizerFast` 解決 `Siglip2Processor` 的映射 bug。
- **Processor Wrapper**: 新增 `ProcessorWrapper` 類以維持原本的調用介面。
- **損失函數**: 修正 `compute_total_loss` 對 `config` 的存取路徑（去除多餘的 `.loss` 階層）。
- **記憶體資訊**: 優化 `get_gpu_memory_info` 為動態偵測總量。

#### 2. 驗證結果

- **環境檢查**: `scripts/verify_setup.py` 通過所有項目。
- **VRAM 使用**: 凍結 towers 後，Batch size 32 運作正常。
